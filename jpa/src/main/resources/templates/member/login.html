<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head::head('로그인')}"></head>
<body>
<header th:replace="~{fragments/header}"></header>

<form action="../member/login" method="post" th:object="${loginDto}"
      class="max-w-md mx-auto mt-16 p-8 rounded-2xl bg-base-100
             border border-base-300 shadow-[0_10px_20px_-10px_rgba(0,0,0,0.25)]">

    <h1 class="text-3xl text-center mb-8 font-bold">로그인</h1>

    <!-- 글로벌 오류 -->
    <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-error shadow mb-4">
        <ul class="list-disc pl-5">
            <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
        </ul>
    </div>

    <!-- USER ID -->
    <div class="form-control">
        <label class="label">
            <span class="label-text font-bold mb-2">USER ID</span>
        </label>
        <input type="text" th:field="*{userID}" placeholder="아이디를 입력하세요."
               class="input input-bordered w-full"/>
        <div th:if="${#fields.hasErrors('userID')}"
             th:errors="*{userID}"
             class="text-error text-sm mt-1"></div>
    </div>

    <!-- PASSWORD -->
    <div class="form-control mt-4">
        <label class="label">
            <span class="label-text font-bold">PASSWORD</span>
        </label>
        <input type="password" th:field="*{userPW}" placeholder="비밀번호 입력"
               class="input input-bordered w-full"/>
        <div th:if="${#fields.hasErrors('userPW')}"
             th:errors="*{userPW}"
             class="text-error text-sm mt-1"></div>
    </div>
    <div th:if="${param.error}" class="my-4 flex items-start text-red-600 text-sm font-medium">
        <span class="mr-2">⚠️</span>
        <span>아이디 또는 비밀번호가 올바르지 않습니다.</span>
        <!-- 개발 중 상세 원인 확인용 -->
        <!-- <small class="block opacity-70 ml-2"
               th:text="${session.SPRING_SECURITY_LAST_EXCEPTION?.message}"></small> -->
    </div>


    <!-- (선택) 로그아웃 후 안내 -->
    <div th:if="${param.logout}" class="alert alert-info shadow mb-4">
        <span>정상적으로 로그아웃되었습니다.</span>
    </div>
    <!-- 로그인 버튼 -->
    <div class="form-control mt-6">
        <button class="btn btn-primary w-full">로그인</button>
    </div>
    <div class="form-control mt-6">
        <div class="flex justify-center items-center text-sm gap-2 text-gray-600">
            <a href="/member/find-id" class="hover:underline">아이디 찾기</a>
            <span class="mx-2">|</span>
            <a href="/member/find-password" class="hover:underline">비밀번호 찾기</a>
        </div>
    </div>


    <!-- SNS 로그인 버튼 -->
    <div class="mt-6 flex flex-col gap-3">
        <a type="button" class="btn btn-outline w-full" href="/oauth2/authorization/google">
            Google 로그인
        </a>
        <a type="button" class="btn w-full bg-yellow-300 hover:bg-yellow-400 text-black border-none"
                href="/oauth2/authorization/kakao"
        >
            Kakao 로그인
        </a>
    </div>
</form>

<div th:replace="~{fragments/footer::footer-sns}"></div>
<script>
    const btnIdCheck = document.querySelector("#btn-id-check");
    const userID = document.querySelector("#userID");
    btnIdCheck.addEventListener("click", async (e) => {
        const res = await fetch("/member/idCheck", {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({userID: userID.value})
        })
        const data = await res.json();
        console.log(data);
        if (data.isDuplicate) {
            alert("쓸 수 없는 아이디 입니다.");
        }
    })
    //로그인까지 만들어 보기...

</script>
</body>
</html>