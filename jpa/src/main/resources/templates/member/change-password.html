<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head::head('로그인')}"></head>
<body>
<header th:replace="~{fragments/header}"></header>

<form action="../member/change-password" method="post"
      class="max-w-md mx-auto mt-16 p-8 rounded-2xl bg-base-100
             border border-base-300 shadow-[0_10px_20px_-10px_rgba(0,0,0,0.25)]"
      th:object="${changePasswordRequest}"
>

    <h1 class="text-3xl text-center mb-8 font-bold">비밀번호변경</h1>

    <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-error shadow mb-4">
        <ul class="list-disc pl-5">
            <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
        </ul>
    </div>


    <!-- USER ID -->
    <div class="form-control mb-4">
        <label class="label">
            <span class="label-text font-bold mb-2">USER PW</span>
        </label>
        <input type="password" placeholder="기존 비밀번호" name="userPW" th:field="*{currentPassword}"
               class="input input-bordered w-full"/>
        <div th:if="${#fields.hasErrors('currentPassword')}"
             th:errors="*{currentPassword}"
             class="text-error text-sm mt-1"></div>
    </div>
    <div class="form-control mb-4">
        <label class="label">
            <span class="label-text font-bold mb-2">CHANGE PW</span>
        </label>
        <input type="password" placeholder="새 비밀번호" name="newPassword"
               th:field="*{newPassword}"
               class="input input-bordered w-full"/>
        <div th:if="${#fields.hasErrors('newPassword')}"
             th:errors="*{newPassword}"
             class="text-error text-sm mt-1"></div>
    </div>
    <div class="form-control mb-4">
        <label class="label">
            <span class="label-text font-bold mb-2">CONFIRM CHANGE PW</span>
        </label>
        <input type="password" placeholder="새 비밀번호 확인" name="changePWConfirm"
               th:field="*{newPasswordConfirm}"
               class="input input-bordered w-full"/>
        <div th:if="${#fields.hasErrors('newPasswordConfirm')}"
             th:errors="*{newPasswordConfirm}"
             class="text-error text-sm mt-1"></div>
    </div>



    <!-- PASSWORD -->
    <div th:if="${param.error}" class="my-4 flex items-start text-red-600 text-sm font-medium">
        <span class="mr-2">⚠️</span>
        <span>아이디 또는 비밀번호가 올바르지 않습니다.</span>
        <!-- 개발 중 상세 원인 확인용 -->
        <!-- <small class="block opacity-70 ml-2"
               th:text="${session.SPRING_SECURITY_LAST_EXCEPTION?.message}"></small> -->
    </div>


    <div class="form-control mt-6">
        <button class="btn btn-primary w-full">이메일 보내기</button>
    </div>
</form>

<div th:replace="~{fragments/footer::footer-sns}"></div>
<script>
    const btnIdCheck = document.querySelector("#btn-id-check");
    const userID = document.querySelector("#userID");
    btnIdCheck.addEventListener("click", async (e) => {
        const res = await fetch("/member/idCheck", {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({userID: userID.value})
        })
        const data = await res.json();
        console.log(data);
        if (data.isDuplicate) {
            alert("쓸 수 없는 아이디 입니다.");
        }
    })
    //로그인까지 만들어 보기...

</script>
</body>
</html>